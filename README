
[![Build Status](https://api.travis-ci.org/guillon/zoostrap.png?branch=master)](https://travis-ci.org/guillon/zoostrap/branches)

# Synopsis

The zoostrap utility is a simple tool for bootstrapping a Linux host
distribution and running command in an unprivileged container.

Actually this tool proceeds in three steps:
- download a reference distribution archive an extract into the specified
rootfs directory
- execute installation of additional packages into this rootfs with `PRoot`
- execute actual commands into this rootfs with `ckains`

The list of available distributions is currently:
- Ubuntu 12.04 (`ZS_DISTRIB_ID=ubuntu ZS_DISTRIB_RELEASE=12.04`)
- Ubuntu 14.04 (`ZS_DISTRIB_ID=ubuntu ZS_DISTRIB_RELEASE=14.04`)
- CentOS 5 (`ZS_DISTRIB_ID=centos ZS_DISTRIB_RELEASE=5`)
- CentOS 6 (`ZS_DISTRIB_ID=centos ZS_DISTRIB_RELEASE=6`)
- CentOS 7 (`ZS_DISTRIB_ID=centos ZS_DISTRIB_RELEASE=7`)
- Fedora 20/21/22/23 (`ZS_DISTRIB_ID=fedora ZS_DISTRIB_RELEASE=20/21/22/23`)

This tool is still a prototype and as of now configuration is passed through
the environment, refer to the TODO file for next steps.

# Download

Download a specific release from the release page:
https://github.com/guillon/zoostrap/releases

Or download the last stable version from there:
https://raw.githubusercontent.com/guillon/zoostrap/master/zoostrap

For instance:

    $ wget -O ~/bin/zoostrap https://raw.githubusercontent.com/guillon/zoostrap/master/zoostrap
    $ chmod +x ~/bin/zoostrap

The first command gets the zoostrap tool and the second command sets execution bit.

# Examples

A typical usage is to bootstrap for instance a CentOS or Ubuntu distribution and then
execute a build command into the installed distribution root tree.

For instance, assuming  zoostrap is available in the path:

    $ env ZS_DISTRIB_ID=ubuntu ZS_DISTRIB_RELEASE=12.04 \
      ZS_DISTRIB_PACKAGES="wget" \
      zoostrap rootfs
    $ rootfs/.zoostrap/run wget https://raw.githubusercontent.com/guillon/zoostrap/master/zoostrap
    ...

The first command installs a Ubuntu 12.04 core root tree in the rootfs/
directory and install the wget package.

The second command executes a wget command in the just installed distro.

One can also do this with a single command, passing the command to execute as parameter:

    $ env ZS_DISTRIB_ID=ubuntu ZS_DISTRIB_RELEASE=12.04 \
      ZS_DISTRIB_PACKAGES="wget" \
      zoostrap rootfs wget https://raw.githubusercontent.com/guillon/zoostrap/master/zoostrap
    ...
# Parameters

zoostrap gets parameters from the environment except for the rootfs directory
to create which is passed as argument.

The available parameters are:

* `ZS_DISTRIB_ID="<distro>"`: one of the known distribution listed above
* `ZS_DISTRIB_RELEASE="<release>"`: one of the known distro release listed above
* `ZS_DISTRIB_PACKAGES="<packages list>"`: space separated list of packages to
  install, note that package names are specific to distributions, it is up to
  the user to give actual packages name depending on the <distro> used
* `ZS_WGET="<wget command>"`: override default wget command and options.
  The default wget command is: `wget --no-check-certificate --tries 3`.
  Note that you may use `--no-check-certificate` without compromising
  security as all downloaded files are checked against there known
  content hash (a sha1sum)

# Build and Install

This script requires bash and wget packages and should work on any Linux
distribution for x86_64 architecture with a kernel >= 3.0.

The script can be used directly without installation.

A makefile is provided for completion and testing purpose.

Build with:

    $ make all # a no-op actually

Run unit tests with:

    $ make check

Install with, for instance:

    $ make install PREFIX=$HOME/local  # Default is PREFIX=/usr/local


# References

Refer to the project home page at:
http://guillon.github.io/zoostrap

Refer to the current build and validation status at:
https://travis-ci.org/guillon/zoostrap?branches

Fill issues and enhancement request at:
https://github.com/guillon/zoostrap/issues

Refer to the TODO file for future work:
https://github.com/guillon/zoostrap/blob/master/TODO

Refer to ckains at: https://github.com/mickael-guene/ckains

Refer to PRoot at: http://proot.me

# License

Refer to the COPYING file: https://github.com/guillon/zoostrap/blob/master/COPYING
Refer to the COPYRIGHT file: https://github.com/guillon/zoostrap/blob/master/COPYRIGHT
