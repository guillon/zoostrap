<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Zoostrap by guillon</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Zoostrap</h1>
      <h2 class="project-tagline">Simple distro container bootstrap tool</h2>
      <a href="https://github.com/guillon/zoostrap" class="btn">View on GitHub</a>
      <a href="https://github.com/guillon/zoostrap/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/guillon/zoostrap/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <p><a href="https://travis-ci.org/guillon/zoostrap/branches"><img src="https://api.travis-ci.org/guillon/zoostrap.png?branch=master" alt="Build Status"></a></p>

<h1>
<a id="synopsis" class="anchor" href="#synopsis" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Synopsis</h1>

<p>The zoostrap utility is a simple tool for bootstrapping a Linux host
distribution and running command in an unprivileged container.</p>

<p>Actually this tool proceeds in three steps:</p>

<ul>
<li>download a reference distribution archive an extract into the specified
rootfs directory</li>
<li>execute installation of additional packages into this rootfs with <code>PRoot</code>
</li>
<li>execute actual commands into this rootfs with <code>ckains</code>
</li>
</ul>

<p>The list of available x86_64 distributions is currently:</p>

<ul>
<li>Ubuntu 12.04 (<code>ZS_DISTRIB_ID=ubuntu ZS_DISTRIB_RELEASE=12.04</code>)</li>
<li>Ubuntu 14.04 (<code>ZS_DISTRIB_ID=ubuntu ZS_DISTRIB_RELEASE=14.04</code>)</li>
<li>Ubuntu 16.04 (<code>ZS_DISTRIB_ID=ubuntu ZS_DISTRIB_RELEASE=16.04</code>)</li>
<li>CentOS 5 (<code>ZS_DISTRIB_ID=centos ZS_DISTRIB_RELEASE=5</code>)</li>
<li>CentOS 6 (<code>ZS_DISTRIB_ID=centos ZS_DISTRIB_RELEASE=6</code>)</li>
<li>CentOS 7 (<code>ZS_DISTRIB_ID=centos ZS_DISTRIB_RELEASE=7</code>)</li>
<li>Fedora 20/21/22/23 (<code>ZS_DISTRIB_ID=fedora ZS_DISTRIB_RELEASE=20/21/22/23</code>)</li>
</ul>

<p>Some x86 distributions are also available with the <code>ZS_DISTRIB_ARCH=i686</code>
parameter:</p>

<ul>
<li>Ubuntu 12.04 (<code>ZS_DISTRIB_ID=ubuntu ZS_DISTRIB_RELEASE=12.04 ZS_DISTRIB_ARCH=i686</code>)</li>
<li>Ubuntu 14.04 (<code>ZS_DISTRIB_ID=ubuntu ZS_DISTRIB_RELEASE=14.04 ZS_DISTRIB_ARCH=i686</code>)</li>
<li>CentOS 5 (<code>ZS_DISTRIB_ID=centos ZS_DISTRIB_RELEASE=5 ZS_DISTRIB_ARCH=i686</code>)</li>
<li>CentOS 6 (<code>ZS_DISTRIB_ID=centos ZS_DISTRIB_RELEASE=6 ZS_DISTRIB_ARCH=i686</code>)</li>
<li>Fedora 20 (<code>ZS_DISTRIB_ID=centos ZS_DISTRIB_RELEASE=20 ZS_DISTRIB_ARCH=i686</code>)</li>
</ul>

<p>This tool is still a prototype and as of now configuration is passed through
the environment, refer to the TODO file for next steps.</p>

<p>Note that this tool requires a kernel &gt;= 3.11.x in order to execute
unprivileged containers.
In particular if you have this kind of error:
<code>ERROR: unshare failed with error Invalid argument</code>. The host distribution
kernel is probably too old.</p>

<p>The tool uses 3 companions tools as backend:</p>

<ul>
<li>PRoot for installation of packages,</li>
<li>ckains for execution of the container,</li>
<li>bcache for cacheing of images.</li>
</ul>

<p>See references section.</p>

<h1>
<a id="download" class="anchor" href="#download" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Download</h1>

<p>Download a specific release from the release page:
<a href="https://github.com/guillon/zoostrap/releases">https://github.com/guillon/zoostrap/releases</a></p>

<p>Or download the last stable version from there:
<a href="https://raw.githubusercontent.com/guillon/zoostrap/master/zoostrap">https://raw.githubusercontent.com/guillon/zoostrap/master/zoostrap</a></p>

<p>For instance:</p>

<pre><code>$ wget -O ~/bin/zoostrap https://raw.githubusercontent.com/guillon/zoostrap/master/zoostrap
$ chmod +x ~/bin/zoostrap
</code></pre>

<p>The first command gets the zoostrap tool and the second command sets execution bit.</p>

<h1>
<a id="examples" class="anchor" href="#examples" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Examples</h1>

<p>A typical usage is to bootstrap for instance a CentOS or Ubuntu distribution and then
execute a build command into the installed distribution root tree.</p>

<p>For instance, assuming  zoostrap is available in the path:</p>

<pre><code>$ env ZS_DISTRIB_ID=ubuntu ZS_DISTRIB_RELEASE=12.04 \
  ZS_DISTRIB_PACKAGES="wget" \
  zoostrap rootfs
$ rootfs/.zoostrap/run wget https://raw.githubusercontent.com/guillon/zoostrap/master/zoostrap
...
</code></pre>

<p>The first command installs a Ubuntu 12.04 core root tree in the rootfs/
directory and install the wget package.</p>

<p>The second command executes a wget command in the just installed distro.</p>

<p>One can also do this with a single command, passing the command to execute as parameter:</p>

<pre><code>$ env ZS_DISTRIB_ID=ubuntu ZS_DISTRIB_RELEASE=12.04 \
  ZS_DISTRIB_PACKAGES="wget" \
  zoostrap rootfs wget https://raw.githubusercontent.com/guillon/zoostrap/master/zoostrap
...
</code></pre>

<h1>
<a id="parameters" class="anchor" href="#parameters" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Parameters</h1>

<p>zoostrap gets parameters from the environment except for the rootfs directory
to create which is passed as argument.</p>

<p>The available parameters are:</p>

<ul>
<li>
<code>ZS_DISTRIB_ID="&lt;distro&gt;"</code>: one of the known distribution listed above.</li>
<li>
<code>ZS_DISTRIB_RELEASE="&lt;release&gt;"</code>: one of the known distro release listed above.</li>
<li>
<code>ZS_DISTRIB_ARCH="&lt;uname-m&gt;"</code>: the requested architecture for the
guest as may be provided by <code>uname -m</code> for instance. The default is the same
as the host architecture. It may be x86_64, amd64 (64 bits) or x86,
i[3456]86 (32 bits).</li>
<li>
<code>ZS_DISTRIB_PACKAGES="&lt;packages list&gt;"</code>: space separated list of packages to
install, note that package names are specific to distributions. It is up to
the user to give actual packages names as expected by the requested
distribution.</li>
<li>
<code>ZS_WGET="&lt;wget command&gt;"</code>: override default wget command and options.
The default wget command is: <code>wget --no-check-certificate --tries 3</code>.
Note that you may use <code>--no-check-certificate</code> without compromising
security as all downloaded files are checked against there known
content hash (a sha1sum).</li>
<li>
<code>ZS_BCACHE=false|true</code>: activates caching of installed images, defaults to
<code>false</code>. If <code>true</code> Images are cached after after  download and packages
installation. The cached installed images are
used on further zoostrap installations if the image identifiers and installed
packages are the same. Cached images are stored into a local <code>ZS_BCACHE_DIR</code>.
The <code>ZS_BCACHE_ID</code> variable can be used to discriminate images optionally,
and have a guarantee that an image is stable (the actual base distro
archives may indeed vary over time), though this is not used generally.
Thus the actual identification of a unique cache entry is done at least with
the tuple (ZS_DISTRIB_ID, ZS_DISTRIB_RELEASE, ZS_DISTRIB_ARCH,
ZS_BCACHE_ID). This option uses the <code>bcache</code> tool.</li>
<li>
<code>ZS_BCACHE_DIR=&lt;cache_dir&gt;</code>: set location of cache when <code>ZS_BCACHE=true</code>,
defaults to <code>$HOME/.bcache</code>. Note that this location holds installed images
which may require some amout of disk space (generally 500Mb par installed
images with a reasonable number of user packegs). There is no management
of space provided by the tool, this location can be cleaned manually.
Note that the startup is much faster if this location is on the same
partition than the instelled root FSs.</li>
<li>
<code>ZS_BCACHE_ID=&lt;any_stiing&gt;</code>: optional discriminent for cached images. Ref to
<code>ZS_BCACHE</code> notes.</li>
<li>
<code>ZS_UPDATE=true|false</code>: run packages list update before installing packages,
defaults to <code>true</code>. This should normally always be active as base distros
images do not have latest packages versions list.</li>
<li>
<code>ZS_UPGRADE=false|true</code>: run packages upgrade before installing packages,
defaults to <code>false</code>. This has an effect only for Ubuntu images and runs
an <code>apt-get upgrade</code> if <code>true</code>. This is normally not required, provided
just as an option. Note that if this is <code>true</code>, caching through <code>ZS_BCACHE</code>
is deactivated.</li>
<li>
<code>ZS_PACKAGES_STRICT/ZS_UPDATE_STRICT/ZS_UPGRADE_STRICT=true|false</code>: these
three variables control the error management on respectively packages
installation, packages update, packages upgrade. There are cases where
packages installation fail due to limitation of the non-privileged PRoot
backend. For instace some packages installation may try to restart damons or
create device nodes, which is not supported. If actually the installation is
correct even when such errors are reported, one may use
<code>ZS_PACKAGES_STRICT=false</code> to work-around the problem.</li>
</ul>

<h1>
<a id="build-and-install" class="anchor" href="#build-and-install" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Build and Install</h1>

<p>This script requires bash and wget packages and should work on any Linux
distribution for x86_64 architecture with a kernel &gt;= 3.0.</p>

<p>The script can be used directly without installation.</p>

<p>A makefile is provided for completion and testing purpose.</p>

<p>Build with:</p>

<pre><code>$ make all # a no-op actually
</code></pre>

<p>Run unit tests with:</p>

<pre><code>$ make check
</code></pre>

<p>Install with, for instance:</p>

<pre><code>$ make install PREFIX=$HOME/local  # Default is PREFIX=/usr/local
</code></pre>

<h1>
<a id="references" class="anchor" href="#references" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>References</h1>

<p>Refer to the project home page at:
<a href="http://guillon.github.com/zoostrap">http://guillon.github.com/zoostrap</a></p>

<p>Refer to the current build and validation status at:
<a href="https://travis-ci.org/guillon/zoostrap?branches">https://travis-ci.org/guillon/zoostrap?branches</a></p>

<p>Fill issues and enhancement request at:
<a href="https://github.com/guillon/zoostrap/issues">https://github.com/guillon/zoostrap/issues</a></p>

<p>Refer to the TODO file for future work:
<a href="https://github.com/guillon/zoostrap/blob/master/TODO">https://github.com/guillon/zoostrap/blob/master/TODO</a></p>

<p>Refer to ckains at: <a href="https://github.com/mickael-guene/ckains">https://github.com/mickael-guene/ckains</a></p>

<p>Refer to PRoot at: <a href="http://proot.me">http://proot.me</a></p>

<p>Refer to bcache at: <a href="https://guillon.github.com/bcache/">https://guillon.github.com/bcache/</a></p>

<h1>
<a id="license" class="anchor" href="#license" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>License</h1>

<p>Refer to the COPYING file: <a href="https://github.com/guillon/zoostrap/blob/master/COPYING">https://github.com/guillon/zoostrap/blob/master/COPYING</a>
Refer to the COPYRIGHT file: <a href="https://github.com/guillon/zoostrap/blob/master/COPYRIGHT">https://github.com/guillon/zoostrap/blob/master/COPYRIGHT</a></p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/guillon/zoostrap">Zoostrap</a> is maintained by <a href="https://github.com/guillon">guillon</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
